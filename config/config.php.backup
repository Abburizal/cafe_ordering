<?php
/**
 * Database Configuration - Render.com Compatible
 */

// Get environment variables with fallbacks
$host = getenv('DB_HOST') ?: (getenv('MYSQL_HOST') ?: 'localhost');
$db = getenv('DB_NAME') ?: (getenv('MYSQL_DATABASE') ?: 'cafe_ordering');
$user = getenv('DB_USER') ?: (getenv('MYSQL_USER') ?: 'root');
$pass = getenv('DB_PASS') ?: (getenv('MYSQL_PASSWORD') ?: '');

// Error handling
if (!$host || !$db || !$user) {
    error_log("Database configuration incomplete. Check environment variables.");
    die("Database configuration error. Contact administrator.");
}

try {
    // Create PDO connection
    $pdo = new PDO(
        "mysql:host=$host;dbname=$db;charset=utf8mb4",
        $user,
        $pass,
        [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
            PDO::ATTR_EMULATE_PREPARES => false,
        ]
    );
    
    // Log successful connection (only in dev)
    if (getenv('APP_ENV') !== 'production') {
        error_log("Database connected: $host / $db");
    }
    
} catch (PDOException $e) {
    error_log("PDO Connection Error: " . $e->getMessage());
    die("Database connection failed. Contact administrator.");
}
?>